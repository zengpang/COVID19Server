const axios = require(`axios`);

//https://c.m.163.com/ug/api/wuhan/app/data/list-total
function getCovidInfo(statename, cityName) {

   return new Promise((resolve, reject) => {
      axios.get(`https://c.m.163.com/ug/api/wuhan/app/data/list-total`)
         .then(response => {
            let reslut = getCityCovidInfo(statename, cityName, response.data.data.areaTree);
            resolve(reslut);
         })
         .catch(e => {
            console.log(e);
            reject(`网络异常`);
         }
         )
   })
}
function getCityCovidInfo(statename = `中国`, cityName, data) {
   let statInfo = null;
   let cityInfo = null;
   try {
      statInfo = data.find(item => {
         return item.name == statename;
      })
      if (!statInfo) {
         return `未找到该国家信息`;
      }
      if(!statInfo.children)
      {
         return `该国家不存在城市`;
      }
      statInfo.children.forEach(province => {
         //考虑到可能会出现省市同级的情况，比如北京
         if(province.name==cityName)
         {
            cityInfo=province;
            return;
         }
         province.children.forEach(city=>{
            
            if(city.name==cityName)
            {
               
               cityInfo=city;
               return;
            }
         })
      });
     
   } catch {

   }
 
   if (!cityInfo) {
      return `未找到该城市信息`;
   }
   return cityInfo;
}
module.exports = getCovidInfo;